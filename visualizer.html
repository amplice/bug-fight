<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug Visualizer</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: #0a0a0a;
            color: #fff;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #ff0;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .back-link {
            text-align: center;
            margin-bottom: 20px;
        }

        .back-link a {
            color: #5af;
            text-decoration: none;
        }

        .back-link a:hover {
            text-decoration: underline;
        }

        .visualizer-layout {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        /* Preview Area */
        .preview-section {
            flex: 1;
            min-width: 300px;
        }

        .preview-container {
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        #preview-canvas {
            background: #2a2520;
            border: 1px solid #444;
            image-rendering: pixelated;
            margin-bottom: 15px;
        }

        .bug-name {
            font-size: 20px;
            color: #ff0;
            margin-bottom: 10px;
        }

        .bug-stats {
            font-size: 12px;
            color: #888;
            margin-bottom: 15px;
        }

        .animation-controls {
            margin-top: 15px;
        }

        .animation-controls button {
            background: #333;
            border: 1px solid #555;
            color: #fff;
            padding: 8px 16px;
            margin: 0 5px;
            cursor: pointer;
            font-family: inherit;
            border-radius: 4px;
        }

        .animation-controls button:hover {
            background: #444;
        }

        .animation-controls button.active {
            background: #0a0;
            border-color: #0f0;
        }

        /* Controls Area */
        .controls-section {
            flex: 1;
            min-width: 400px;
        }

        .control-group {
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .control-group h3 {
            color: #ff0;
            font-size: 14px;
            margin-bottom: 12px;
            border-bottom: 1px solid #333;
            padding-bottom: 8px;
        }

        .option-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .option-btn {
            background: #2a2a2a;
            border: 2px solid #444;
            color: #ccc;
            padding: 10px 16px;
            cursor: pointer;
            font-family: inherit;
            font-size: 13px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .option-btn:hover {
            background: #3a3a3a;
            border-color: #666;
        }

        .option-btn.selected {
            background: #1a3a1a;
            border-color: #0f0;
            color: #0f0;
        }

        /* Sliders */
        .slider-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .slider-row label {
            width: 100px;
            color: #aaa;
            font-size: 12px;
        }

        .slider-row input[type="range"] {
            flex: 1;
            margin: 0 10px;
            accent-color: #0f0;
        }

        .slider-row .value {
            width: 50px;
            text-align: right;
            color: #ff0;
            font-size: 14px;
        }

        /* Color picker */
        .color-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .color-preview {
            width: 40px;
            height: 40px;
            border: 2px solid #555;
            border-radius: 4px;
        }

        /* Combat types */
        .combat-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .combat-column h4 {
            color: #888;
            font-size: 11px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        /* Random button */
        .random-btn {
            width: 100%;
            background: linear-gradient(180deg, #a50, #730);
            border: none;
            color: #fff;
            padding: 15px;
            font-size: 16px;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            border-radius: 6px;
            margin-top: 10px;
        }

        .random-btn:hover {
            background: linear-gradient(180deg, #c60, #940);
        }

        /* All combinations grid */
        .combinations-section {
            margin-top: 30px;
        }

        .combinations-section h2 {
            color: #ff0;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
        }

        .combinations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 15px;
        }

        .combo-cell {
            background: #2a2520;
            border: 1px solid #333;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 4px;
        }

        .combo-cell:hover {
            border-color: #0f0;
        }

        .combo-cell canvas {
            image-rendering: pixelated;
        }

        .combo-label {
            text-align: center;
            font-size: 9px;
            color: #666;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>BUG VISUALIZER</h1>
        <div class="back-link">
            <a href="index.html">&larr; Back to Bug Fights</a>
        </div>

        <div class="visualizer-layout">
            <!-- Preview -->
            <div class="preview-section">
                <div class="preview-container">
                    <canvas id="preview-canvas" width="200" height="200"></canvas>
                    <div class="bug-name" id="bug-name">-</div>
                    <div class="bug-stats" id="bug-stats">-</div>

                    <div class="animation-controls">
                        <button class="anim-btn active" data-state="idle">Idle</button>
                        <button class="anim-btn" data-state="attack">Attack</button>
                        <button class="anim-btn" data-state="hit">Hit</button>
                        <button class="anim-btn" data-state="death">Death</button>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-section">
                <!-- Body Type -->
                <div class="control-group">
                    <h3>BODY TYPE</h3>
                    <div class="option-buttons" id="body-options">
                        <button class="option-btn selected" data-value="beetle">Beetle</button>
                        <button class="option-btn" data-value="ant">Ant</button>
                        <button class="option-btn" data-value="spider">Spider</button>
                        <button class="option-btn" data-value="mantis">Mantis</button>
                        <button class="option-btn" data-value="roach">Roach</button>
                    </div>
                </div>

                <!-- Head Type -->
                <div class="control-group">
                    <h3>HEAD TYPE</h3>
                    <div class="option-buttons" id="head-options">
                        <button class="option-btn selected" data-value="round">Round</button>
                        <button class="option-btn" data-value="triangular">Triangular</button>
                        <button class="option-btn" data-value="flat">Flat</button>
                        <button class="option-btn" data-value="elongated">Elongated</button>
                    </div>
                </div>

                <!-- Leg Style -->
                <div class="control-group">
                    <h3>LEG STYLE</h3>
                    <div class="option-buttons" id="leg-options">
                        <button class="option-btn selected" data-value="thin">Thin</button>
                        <button class="option-btn" data-value="thick">Thick</button>
                        <button class="option-btn" data-value="bent">Bent</button>
                        <button class="option-btn" data-value="stubby">Stubby</button>
                    </div>
                </div>

                <!-- Pattern -->
                <div class="control-group">
                    <h3>PATTERN</h3>
                    <div class="option-buttons" id="pattern-options">
                        <button class="option-btn selected" data-value="solid">Solid</button>
                        <button class="option-btn" data-value="striped">Striped</button>
                        <button class="option-btn" data-value="spotted">Spotted</button>
                        <button class="option-btn" data-value="segmented">Segmented</button>
                    </div>
                </div>

                <!-- Combat Types -->
                <div class="control-group">
                    <h3>COMBAT TYPES</h3>
                    <div class="combat-group">
                        <div class="combat-column">
                            <h4>Weapon</h4>
                            <div class="option-buttons" id="weapon-options">
                                <button class="option-btn selected" data-value="mandibles">Mandibles</button>
                                <button class="option-btn" data-value="stinger">Stinger</button>
                                <button class="option-btn" data-value="fangs">Fangs</button>
                                <button class="option-btn" data-value="claws">Claws</button>
                            </div>
                        </div>
                        <div class="combat-column">
                            <h4>Defense</h4>
                            <div class="option-buttons" id="defense-options">
                                <button class="option-btn selected" data-value="shell">Shell</button>
                                <button class="option-btn" data-value="agility">Agility</button>
                                <button class="option-btn" data-value="toxic">Toxic</button>
                                <button class="option-btn" data-value="camouflage">Camo</button>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 12px;">
                        <h4 style="color: #888; font-size: 11px; margin-bottom: 8px; text-transform: uppercase;">Mobility</h4>
                        <div class="option-buttons" id="mobility-options">
                            <button class="option-btn selected" data-value="ground">Ground</button>
                            <button class="option-btn" data-value="winged">Winged</button>
                            <button class="option-btn" data-value="wallcrawler">Wallcrawler</button>
                        </div>
                    </div>
                </div>

                <!-- Size & Color -->
                <div class="control-group">
                    <h3>SIZE & COLOR</h3>
                    <div class="slider-row">
                        <label>Bulk (Size)</label>
                        <input type="range" id="bulk-slider" min="10" max="100" value="50">
                        <span class="value" id="bulk-value">50</span>
                    </div>
                    <div class="slider-row">
                        <label>Speed</label>
                        <input type="range" id="speed-slider" min="10" max="100" value="50">
                        <span class="value" id="speed-value">50</span>
                    </div>
                    <div class="slider-row">
                        <label>Fury</label>
                        <input type="range" id="fury-slider" min="10" max="100" value="50">
                        <span class="value" id="fury-value">50</span>
                    </div>
                    <div class="slider-row">
                        <label>Instinct</label>
                        <input type="range" id="instinct-slider" min="10" max="100" value="50">
                        <span class="value" id="instinct-value">50</span>
                    </div>
                    <div class="slider-row">
                        <label>Hue</label>
                        <input type="range" id="hue-slider" min="0" max="360" value="120">
                        <div class="color-preview" id="color-preview"></div>
                    </div>
                    <div class="slider-row">
                        <label>Saturation</label>
                        <input type="range" id="saturation-slider" min="30" max="100" value="70">
                        <span class="value" id="saturation-value">70%</span>
                    </div>
                    <div class="slider-row">
                        <label>Lightness</label>
                        <input type="range" id="lightness-slider" min="25" max="60" value="40">
                        <span class="value" id="lightness-value">40%</span>
                    </div>
                </div>

                <button class="random-btn" id="random-btn">RANDOMIZE</button>
            </div>
        </div>

        <!-- All Body Type Combinations -->
        <div class="combinations-section">
            <h2>ALL BODY TYPES</h2>
            <div class="combinations-grid" id="body-grid"></div>
        </div>
    </div>

    <script src="js/procedural.js"></script>
    <script>
        // State
        let currentGenome = null;
        let currentBug = null;
        let currentState = 'idle';
        let animFrame = 0;
        let animLoop = null;

        const canvas = document.getElementById('preview-canvas');
        const ctx = canvas.getContext('2d');

        // Get current selections
        function getSelections() {
            return {
                bodyType: document.querySelector('#body-options .selected')?.dataset.value || 'beetle',
                headType: document.querySelector('#head-options .selected')?.dataset.value || 'round',
                legStyle: document.querySelector('#leg-options .selected')?.dataset.value || 'thin',
                pattern: document.querySelector('#pattern-options .selected')?.dataset.value || 'solid',
                weapon: document.querySelector('#weapon-options .selected')?.dataset.value || 'mandibles',
                defense: document.querySelector('#defense-options .selected')?.dataset.value || 'shell',
                mobility: document.querySelector('#mobility-options .selected')?.dataset.value || 'ground',
                bulk: parseInt(document.getElementById('bulk-slider').value),
                speed: parseInt(document.getElementById('speed-slider').value),
                fury: parseInt(document.getElementById('fury-slider').value),
                instinct: parseInt(document.getElementById('instinct-slider').value),
                hue: parseInt(document.getElementById('hue-slider').value),
                saturation: parseInt(document.getElementById('saturation-slider').value) / 100,
                lightness: parseInt(document.getElementById('lightness-slider').value) / 100
            };
        }

        // Create bug from selections
        function createBugFromSelections() {
            const sel = getSelections();

            // Create genome manually
            const genome = new BugGenome({
                bulk: sel.bulk,
                speed: sel.speed,
                fury: sel.fury,
                instinct: sel.instinct,
                bodyType: sel.bodyType,
                headType: sel.headType,
                legStyle: sel.legStyle,
                pattern: sel.pattern,
                weapon: sel.weapon,
                defense: sel.defense,
                mobility: sel.mobility,
                color: {
                    hue: sel.hue,
                    saturation: sel.saturation,
                    lightness: sel.lightness
                },
                accentHue: (sel.hue + 45) % 360
            });

            currentBug = BugFactory.createFromGenome(genome);
            updateDisplay();
        }

        // Update the preview display
        function updateDisplay() {
            if (!currentBug) return;

            // Update name and stats
            document.getElementById('bug-name').textContent = currentBug.name;
            const g = currentBug.genome;
            document.getElementById('bug-stats').innerHTML =
                `Size: ${currentBug.size}px | ` +
                `BLK:${g.bulk} SPD:${g.speed} FRY:${g.fury} INS:${g.instinct}<br>` +
                `${g.bodyType} / ${g.headType} / ${g.legStyle} / ${g.pattern}`;

            // Update color preview
            const hue = parseInt(document.getElementById('hue-slider').value);
            const sat = parseInt(document.getElementById('saturation-slider').value);
            const light = parseInt(document.getElementById('lightness-slider').value);
            document.getElementById('color-preview').style.background =
                `hsl(${hue}, ${sat}%, ${light}%)`;
        }

        // Render the bug
        function renderBug() {
            if (!currentBug) return;

            ctx.fillStyle = '#2a2520';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const sprite = currentBug.sprite;
            const frames = sprite[currentState];
            const frame = frames[animFrame % frames.length];
            const colors = sprite.colors;
            const size = currentBug.size;

            // Scale to fit canvas nicely
            const scale = Math.min(180 / size, 6);
            const startX = (canvas.width - size * scale) / 2;
            const startY = (canvas.height - size * scale) / 2;

            // Draw pixels
            for (let py = 0; py < size; py++) {
                for (let px = 0; px < size; px++) {
                    const colorIdx = parseInt(frame[py][px]);
                    if (colorIdx === 0) continue;

                    ctx.fillStyle = colors[colorIdx];
                    ctx.fillRect(
                        startX + px * scale,
                        startY + py * scale,
                        scale + 0.5,
                        scale + 0.5
                    );
                }
            }

            // Size indicator
            ctx.fillStyle = '#666';
            ctx.font = '10px monospace';
            ctx.textAlign = 'center';
            ctx.fillText(`${size}x${size}px`, canvas.width / 2, canvas.height - 5);
        }

        // Animation loop (slowed down for better visibility)
        let frameCounter = 0;
        function animate() {
            frameCounter++;
            // Only advance animation every 10 frames (~6fps instead of 60fps)
            if (frameCounter >= 10) {
                frameCounter = 0;
                animFrame++;
            }
            renderBug();
            animLoop = requestAnimationFrame(animate);
        }

        // Setup button groups
        function setupOptionButtons(containerId, onChange) {
            const container = document.getElementById(containerId);
            container.querySelectorAll('.option-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    container.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    onChange();
                });
            });
        }

        // Setup sliders
        function setupSlider(sliderId, valueId, suffix = '', onChange) {
            const slider = document.getElementById(sliderId);
            const valueEl = document.getElementById(valueId);

            slider.addEventListener('input', () => {
                if (valueEl) valueEl.textContent = slider.value + suffix;
                onChange();
            });
        }

        // Generate body type grid
        function generateBodyGrid() {
            const grid = document.getElementById('body-grid');
            grid.innerHTML = '';

            const bodyTypes = ['beetle', 'ant', 'spider', 'mantis', 'roach'];
            const colors = [0, 60, 120, 180, 240, 300]; // Different hues

            bodyTypes.forEach(bodyType => {
                colors.forEach(hue => {
                    const cell = document.createElement('div');
                    cell.className = 'combo-cell';
                    cell.title = `${bodyType} (hue: ${hue})`;

                    const miniCanvas = document.createElement('canvas');
                    miniCanvas.width = 64;
                    miniCanvas.height = 64;
                    cell.appendChild(miniCanvas);

                    // Create bug with this body type
                    const genome = new BugGenome({
                        bulk: 60,
                        speed: 60,
                        fury: 60,
                        instinct: 60,
                        bodyType: bodyType,
                        headType: 'round',
                        legStyle: 'thin',
                        pattern: 'solid',
                        weapon: 'mandibles',
                        defense: 'shell',
                        mobility: 'ground',
                        color: { hue: hue, saturation: 0.7, lightness: 0.4 },
                        accentHue: (hue + 45) % 360
                    });

                    const bug = BugFactory.createFromGenome(genome);
                    renderMiniPreview(miniCanvas, bug);

                    // Click to apply
                    cell.addEventListener('click', () => {
                        // Update selections
                        document.querySelectorAll('#body-options .option-btn').forEach(b => {
                            b.classList.toggle('selected', b.dataset.value === bodyType);
                        });
                        document.getElementById('hue-slider').value = hue;
                        createBugFromSelections();
                    });

                    grid.appendChild(cell);
                });
            });
        }

        function renderMiniPreview(canvas, bug) {
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#2a2520';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const sprite = bug.sprite;
            const frame = sprite.idle[0];
            const colors = sprite.colors;
            const size = bug.size;

            const scale = Math.min(56 / size, 3);
            const startX = (canvas.width - size * scale) / 2;
            const startY = (canvas.height - size * scale) / 2;

            for (let py = 0; py < size; py++) {
                for (let px = 0; px < size; px++) {
                    const colorIdx = parseInt(frame[py][px]);
                    if (colorIdx === 0) continue;

                    ctx.fillStyle = colors[colorIdx];
                    ctx.fillRect(
                        startX + px * scale,
                        startY + py * scale,
                        scale + 0.5,
                        scale + 0.5
                    );
                }
            }
        }

        // Randomize
        function randomize() {
            const randomBug = BugFactory.createRandom();
            const g = randomBug.genome;

            // Update all controls to match
            document.querySelectorAll('#body-options .option-btn').forEach(b => {
                b.classList.toggle('selected', b.dataset.value === g.bodyType);
            });
            document.querySelectorAll('#head-options .option-btn').forEach(b => {
                b.classList.toggle('selected', b.dataset.value === g.headType);
            });
            document.querySelectorAll('#leg-options .option-btn').forEach(b => {
                b.classList.toggle('selected', b.dataset.value === g.legStyle);
            });
            document.querySelectorAll('#pattern-options .option-btn').forEach(b => {
                b.classList.toggle('selected', b.dataset.value === g.pattern);
            });
            document.querySelectorAll('#weapon-options .option-btn').forEach(b => {
                b.classList.toggle('selected', b.dataset.value === g.weapon);
            });
            document.querySelectorAll('#defense-options .option-btn').forEach(b => {
                b.classList.toggle('selected', b.dataset.value === g.defense);
            });
            document.querySelectorAll('#mobility-options .option-btn').forEach(b => {
                b.classList.toggle('selected', b.dataset.value === g.mobility);
            });

            document.getElementById('bulk-slider').value = g.bulk;
            document.getElementById('bulk-value').textContent = g.bulk;
            document.getElementById('speed-slider').value = g.speed;
            document.getElementById('speed-value').textContent = g.speed;
            document.getElementById('fury-slider').value = g.fury;
            document.getElementById('fury-value').textContent = g.fury;
            document.getElementById('instinct-slider').value = g.instinct;
            document.getElementById('instinct-value').textContent = g.instinct;

            document.getElementById('hue-slider').value = Math.round(g.color.hue);
            document.getElementById('saturation-slider').value = Math.round(g.color.saturation * 100);
            document.getElementById('saturation-value').textContent = Math.round(g.color.saturation * 100) + '%';
            document.getElementById('lightness-slider').value = Math.round(g.color.lightness * 100);
            document.getElementById('lightness-value').textContent = Math.round(g.color.lightness * 100) + '%';

            currentBug = randomBug;
            updateDisplay();
        }

        // Animation state buttons
        document.querySelectorAll('.anim-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.anim-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentState = btn.dataset.state;
                animFrame = 0;
            });
        });

        // Initialize
        function init() {
            // Setup all option button groups
            setupOptionButtons('body-options', createBugFromSelections);
            setupOptionButtons('head-options', createBugFromSelections);
            setupOptionButtons('leg-options', createBugFromSelections);
            setupOptionButtons('pattern-options', createBugFromSelections);
            setupOptionButtons('weapon-options', createBugFromSelections);
            setupOptionButtons('defense-options', createBugFromSelections);
            setupOptionButtons('mobility-options', createBugFromSelections);

            // Setup sliders
            setupSlider('bulk-slider', 'bulk-value', '', createBugFromSelections);
            setupSlider('speed-slider', 'speed-value', '', createBugFromSelections);
            setupSlider('fury-slider', 'fury-value', '', createBugFromSelections);
            setupSlider('instinct-slider', 'instinct-value', '', createBugFromSelections);
            setupSlider('hue-slider', null, '', createBugFromSelections);
            setupSlider('saturation-slider', 'saturation-value', '%', createBugFromSelections);
            setupSlider('lightness-slider', 'lightness-value', '%', createBugFromSelections);

            // Random button
            document.getElementById('random-btn').addEventListener('click', randomize);

            // Generate grid
            generateBodyGrid();

            // Create initial bug
            createBugFromSelections();

            // Start animation
            animate();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
